<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>KVN Parsing Test</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/satellite.js@6.0.1/dist/satellite.min.js\"></script>\n</head>\n<body>\n    <h1>KVN Parsing Test</h1>\n    <textarea id=\"kvn-input\" rows=\"15\" cols=\"80\">CCSDS_OMM_VERS = 2.0\nCOMMENT = International Space Station\nCREATION_DATE = 2023-085T12:00:00.000\nORIGINATOR = JSpOC\nOBJECT_NAME = ISS (ZARYA)\nOBJECT_ID = 1998-067A\nCENTER_NAME = EARTH\nREF_FRAME = ITRF97\nTIME_SYSTEM = UTC\nMEAN_ELEMENT_THEORY = SGP4\nEPOCH = 2023-085T05:19:34.116960\nMEAN_MOTION = 15.49598850\nECCENTRICITY = 0.0003150\nINCLINATION = 51.6435\nRA_OF_ASC_NODE = 106.9059\nARG_OF_PERICENTER = 268.2073\nMEAN_ANOMALY = 91.8026\nEPHEMERIS_TYPE = 0\nCLASSIFICATION_TYPE = U\nNORAD_CAT_ID = 25544\nELEMENT_SET_NO = 999\nREV_AT_EPOCH = 12345\nBSTAR = 0.000036618\nMEAN_MOTION_DOT = 0.000033220\nMEAN_MOTION_DDOT = 0</textarea><br>\n    <button onclick=\"testParsing()\">Test KVN Parsing</button>\n    \n    <div id=\"result\"></div>\n\n    <script>\n        // Include the parsing function\n        function parseOMMKVN(kvnString) {\n          const lines = kvnString.split('\\n').map(line => line.trim()).filter(line => line.length > 0);\n          const ommObject = {};\n          \n          // Define which fields should be treated as numeric vs string\n          const numericFields = new Set([\n            'NORAD_CAT_ID', 'MEAN_MOTION', 'ECCENTRICITY', 'INCLINATION', 'RA_OF_ASC_NODE',\n            'ARG_OF_PERICENTER', 'MEAN_ANOMALY', 'ELEMENT_SET_NO', 'REV_AT_EPOCH', 'BSTAR',\n            'MEAN_MOTION_DOT', 'MEAN_MOTION_DDOT', 'EPHEMERIS_TYPE'\n          ]);\n          \n          for (const line of lines) {\n            // Look for key = value pattern, allowing for optional whitespace\n            const match = line.match(/^([A-Z_][A-Z0-9_]*)\\s*=\\s*(.*?)\\s*$/);\n            if (match) {\n              const key = match[1];\n              let value = match[2].trim();\n              \n              // Try to convert to appropriate data type\n              if (value === 'true') {\n                value = true;\n              } else if (value === 'false') {\n                value = false;\n              } else if (value === 'null') {\n                value = null;\n              } else if (numericFields.has(key)) {\n                // For known numeric fields, force conversion to number\n                const numValue = parseFloat(value);\n                if (!isNaN(numValue)) {\n                  value = numValue;\n                } else {\n                  // If parsing fails, keep as original string\n                  // Remove quotes if present\n                  if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n                    value = value.substring(1, value.length - 1);\n                  }\n                }\n              } else if (!isNaN(value) && !isNaN(parseFloat(value))) {\n                // For other fields, convert to number if it looks like a number\n                value = parseFloat(value);\n                // If it's a whole number, make it an integer\n                if (Number.isInteger(value)) {\n                  value = parseInt(value, 10);\n                }\n              } else {\n                // Remove quotes if present for non-numeric values\n                if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n                  value = value.substring(1, value.length - 1);\n                }\n              }\n              \n              ommObject[key] = value;\n            }\n          }\n          \n          return ommObject;\n        }\n        \n        function validateOMM(ommData) {\n            try {\n                // Validate required OMM fields\n                const requiredFields = [\n                    'OBJECT_NAME',\n                    'NORAD_CAT_ID', \n                    'EPOCH',\n                    'MEAN_MOTION',\n                    'ECCENTRICITY',\n                    'INCLINATION',\n                    'RA_OF_ASC_NODE',\n                    'ARG_OF_PERICENTER',\n                    'MEAN_ANOMALY'\n                ];\n                \n                for (const field of requiredFields) {\n                    if (ommData[field] === undefined) {\n                        return false;\n                    }\n                }\n                \n                // Validate data types\n                if (typeof ommData.NORAD_CAT_ID !== 'number' && typeof ommData.NORAD_CAT_ID !== 'string') {\n                    return false;\n                }\n                \n                if (typeof ommData.EPOCH !== 'string') {\n                    return false;\n                }\n                \n                if (isNaN(parseFloat(ommData.MEAN_MOTION)) || isNaN(parseFloat(ommData.ECCENTRICITY)) ||\n                    isNaN(parseFloat(ommData.INCLINATION)) || isNaN(parseFloat(ommData.RA_OF_ASC_NODE)) ||\n                    isNaN(parseFloat(ommData.ARG_OF_PERICENTER)) || isNaN(parseFloat(ommData.MEAN_ANOMALY))) {\n                    return false;\n                }\n                \n                return true;\n            } catch (error) {\n                // If parsing fails, it's not valid OMM\n                return false;\n            }\n        }\n\n        function testParsing() {\n            const kvnData = document.getElementById('kvn-input').value;\n            const parsed = parseOMMKVN(kvnData);\n            let result = '<h3>Parsed Object:</h3><pre>' + JSON.stringify(parsed, null, 2) + '</pre>';\n            \n            const isValid = validateOMM(parsed);\n            result += '<h3>Validation: ' + (isValid ? 'PASS' : 'FAIL') + '</h3>';\n            \n            if (isValid && typeof satellite.json2satrec === 'function') {\n                try {\n                    const satrec = satellite.json2satrec(parsed);\n                    if (satrec && satrec.error) {\n                        result += '<h3>satrec error: ' + satrec.error + '</h3>';\n                    } else {\n                        result += '<h3>satrec created successfully!</h3>';\n                        \n                        // Try propagation\n                        try {\n                            const positionAndVelocity = satellite.propagate(satrec, new Date());\n                            if (positionAndVelocity === null) {\n                                result += '<h3>Propagation failed - null result</h3>';\n                            } else {\n                                const pos = positionAndVelocity.position;\n                                if (!pos || isNaN(pos.x) || isNaN(pos.y) || isNaN(pos.z)) {\n                                    result += '<h3>Propagation failed - invalid position: ' + \n                                        `x=${pos?pos.x:'null'}, y=${pos?pos.y:'null'}, z=${pos?pos.z:'null'}</h3>`;\n                                } else {\n                                    result += '<h3>Propagation successful!</h3>';\n                                    result += `<p>Position: x=${pos.x}, y=${pos.y}, z=${pos.z}</p>`;\n                                }\n                            }\n                        } catch (propError) {\n                            result += '<h3>Propagation error: ' + propError.message + '</h3>';\n                        }\n                    }\n                } catch (e) {\n                    result += '<h3>Error creating satrec: ' + e.message + '</h3>';\n                }\n            } else if (!isValid) {\n                result += '<h3>OMM validation failed - required fields may be missing or invalid</h3>';\n            } else {\n                result += '<h3>json2satrec function not available</h3>';\n            }\n            \n            document.getElementById('result').innerHTML = result;\n        }\n    </script>\n</body>\n</html>