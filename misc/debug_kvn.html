<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Debug KVN Format</title>\n    <script src=\"https://cdn.jsdelivr.net/npm/satellite.js@6.0.1/dist/satellite.min.js\"></script>\n</head>\n<body>\n    <h1>Debug KVN Format Processing</h1>\n    \n    <h2>Input Data:</h2>\n    <textarea id=\"input-data\" rows=\"20\" cols=\"80\">CCSDS_OMM_VERS = 2.0\nCOMMENT = Sample Satellite\nCREATION_DATE = 2023-085T12:00:00.000\nORIGINATOR = JSpOC\nOBJECT_NAME = ISS (ZARYA)\nOBJECT_ID = 1998-067A\nCENTER_NAME = EARTH\nREF_FRAME = ITRF97\nTIME_SYSTEM = UTC\nMEAN_ELEMENT_THEORY = SGP4\nEPOCH = 2023-03-26T05:19:34.116960\nMEAN_MOTION = 15.49598850\nECCENTRICITY = 0.000315\nINCLINATION = 51.6435\nRA_OF_ASC_NODE = 106.9059\nARG_OF_PERICENTER = 268.2073\nMEAN_ANOMALY = 91.8026\nEPHEMERIS_TYPE = 0\nCLASSIFICATION_TYPE = U\nNORAD_CAT_ID = 25544\nELEMENT_SET_NO = 999\nREV_AT_EPOCH = 12345\nBSTAR = 0.000036618\nMEAN_MOTION_DOT = 0.00003322\nMEAN_MOTION_DDOT = 0</textarea><br>\n    <button onclick=\"debugProcessing()\">Debug Processing</button>\n    \n    <div id=\"output\"></div>\n\n    <script>\n        function parseOMMKVN(kvnString) {\n          const lines = kvnString.split('\\n').map(line => line.trim()).filter(line => line.length > 0);\n          const ommObject = {};\n          \n          // Define which fields should be treated as numeric vs string\n          const numericFields = new Set([\n            'NORAD_CAT_ID', 'MEAN_MOTION', 'ECCENTRICITY', 'INCLINATION', 'RA_OF_ASC_NODE',\n            'ARG_OF_PERICENTER', 'MEAN_ANOMALY', 'ELEMENT_SET_NO', 'REV_AT_EPOCH', 'BSTAR',\n            'MEAN_MOTION_DOT', 'MEAN_MOTION_DDOT', 'EPHEMERIS_TYPE'\n          ]);\n          \n          for (const line of lines) {\n            // Look for key = value pattern, allowing for optional whitespace\n            const match = line.match(/^([A-Z_][A-Z0-9_]*)\\s*=\\s*(.*?)\\s*$/);\n            if (match) {\n              const key = match[1];\n              let value = match[2].trim();\n              \n              console.log(`Processing: ${key} = ${value}`);\n              \n              // Try to convert to appropriate data type\n              if (value === 'true') {\n                value = true;\n                console.log(`  -> Converted to boolean true`);\n              } else if (value === 'false') {\n                value = false;\n                console.log(`  -> Converted to boolean false`);\n              } else if (value === 'null') {\n                value = null;\n                console.log(`  -> Converted to null`);\n              } else if (numericFields.has(key)) {\n                // For known numeric fields, force conversion to number\n                const numValue = parseFloat(value);\n                if (!isNaN(numValue)) {\n                  value = numValue;\n                  console.log(`  -> Converted to number: ${numValue} (type: ${typeof numValue})`);\n                } else {\n                  // If parsing fails, keep as original string\n                  // Remove quotes if present\n                  if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n                    value = value.substring(1, value.length - 1);\n                  }\n                  console.log(`  -> Kept as string after failed number conversion: ${value}`);\n                }\n              } else if (!isNaN(value) && !isNaN(parseFloat(value))) {\n                // For other fields, convert to number if it looks like a number\n                value = parseFloat(value);\n                // If it's a whole number, make it an integer\n                if (Number.isInteger(value)) {\n                  value = parseInt(value, 10);\n                }\n                console.log(`  -> Converted other field to number: ${value} (type: ${typeof value})`);\n              } else {\n                // Remove quotes if present for non-numeric values\n                if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n                  value = value.substring(1, value.length - 1);\n                }\n                console.log(`  -> Kept as string: ${value} (type: ${typeof value})`);\n              }\n              \n              ommObject[key] = value;\n            }\n          }\n          \n          return ommObject;\n        }\n        \n        function debugProcessing() {\n            const inputData = document.getElementById('input-data').value;\n            let output = '<h3>Debugging Steps:</h3>';\n            \n            try {\n                output += '<h4>Step 1: Parse KVN format</h4>';\n                const parsed = parseOMMKVN(inputData);\n                output += '<p>Parsed object:</p><pre>' + JSON.stringify(parsed, null, 2) + '</pre>';\n                \n                output += '<h4>Step 2: Call json2satrec</h4>';\n                if (typeof satellite.json2satrec !== 'function') {\n                    output += '<p style=\"color:red\">ERROR: json2satrec function not available in satellite.js</p>';\n                    document.getElementById('output').innerHTML = output;\n                    return;\n                }\n                \n                let satrec;\n                try {\n                    satrec = satellite.json2satrec(parsed);\n                    output += '<p>satrec object created</p>';\n                    \n                    if (satrec && satrec.error) {\n                        output += `<p style=\"color:red\">satrec has error: ${satrec.error}</p>`;\n                    } else {\n                        output += '<p style=\"color:green\">No error in satrec</p>';\n                    }\n                } catch (e) {\n                    output += `<p style=\"color:red\">Exception when calling json2satrec: ${e.message}</p>`;\n                    document.getElementById('output').innerHTML = output;\n                    return;\n                }\n                \n                output += '<h4>Step 3: Try propagation</h4>';\n                try {\n                    const positionAndVelocity = satellite.propagate(satrec, new Date());\n                    output += '<p>Propagation attempted</p>';\n                    \n                    if (positionAndVelocity === null) {\n                        output += '<p style=\"color:red\">ERROR: Propagation returned null</p>';\n                    } else {\n                        const pos = positionAndVelocity.position;\n                        if (!pos || isNaN(pos.x) || isNaN(pos.y) || isNaN(pos.z)) {\n                            output += `<p style=\"color:red\">ERROR: Invalid position - x=${pos?pos.x:'null'}, y=${pos?pos.y:'null'}, z=${pos?pos.z:'null'}</p>`;\n                        } else {\n                            output += `<p style=\"color:green\">SUCCESS: Position - x=${pos.x}, y=${pos.y}, z=${pos.z}</p>`;\n                        }\n                    }\n                } catch (propError) {\n                    output += `<p style=\"color:red\">Propagation error: ${propError.message}</p>`;\n                }\n                \n                output += '<h4>Complete OMM Object for Reference:</h4>';\n                output += '<pre>' + JSON.stringify(parsed, null, 2) + '</pre>';\n                \n            } catch (error) {\n                output += `<p style=\"color:red\">Overall error: ${error.message}</p>`;\n                output += `<pre>${error.stack}</pre>`;\n            }\n            \n            document.getElementById('output').innerHTML = output;\n        }\n    </script>\n</body>\n</html>