<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>OMM Integration Test</title>\n    <script src="https://cdn.jsdelivr.net/npm/satellite.js@6.0.1/dist/satellite.min.js"></script>\n</head>\n<body>\n    <h1>OMM Integration Test</h1>\n    <p>This page tests the OMM parsing and validation functions without the full UI.</p>\n    \n    <h2>Test JSON OMM</h2>\n    <textarea id=\"json-omm\" rows=\"10\" cols=\"80\">{\n  \"OBJECT_NAME\": \"ISS (ZARYA)\",\n  \"OBJECT_ID\": \"1998-067A\",\n  \"EPOCH\": \"2023-03-26T05:19:34.116960\",\n  \"MEAN_MOTION\": 15.49598850,\n  \"ECCENTRICITY\": 0.000315,\n  \"INCLINATION\": 51.6435,\n  \"RA_OF_ASC_NODE\": 106.9059,\n  \"ARG_OF_PERICENTER\": 268.2073,\n  \"MEAN_ANOMALY\": 91.8026,\n  \"EPHEMERIS_TYPE\": 0,\n  \"CLASSIFICATION_TYPE\": \"U\",\n  \"NORAD_CAT_ID\": 25544,\n  \"ELEMENT_SET_NO\": 999,\n  \"REV_AT_EPOCH\": 12345,\n  \"BSTAR\": 0.000036618,\n  \"MEAN_MOTION_DOT\": 0.00003322,\n  \"MEAN_MOTION_DDOT\": 0\n}</textarea><br>\n    <button onclick=\"testJSONOMM()\">Test JSON OMM</button>\n\n    <h2>Test KVN OMM</h2>\n    <textarea id=\"kvn-omm\" rows=\"15\" cols=\"80\">CCSDS_OMM_VERS = 2.0\nCOMMENT = International Space Station\nCREATION_DATE = 2023-085T12:00:00.000\nORIGINATOR = JSpOC\nOBJECT_NAME = ISS (ZARYA)\nOBJECT_ID = 1998-067A\nCENTER_NAME = EARTH\nREF_FRAME = ITRF97\nTIME_SYSTEM = UTC\nMEAN_ELEMENT_THEORY = SGP4\nEPOCH = 2023-085T05:19:34.116960\nMEAN_MOTION = 15.49598850\nECCENTRICITY = 0.0003150\nINCLINATION = 51.6435\nRA_OF_ASC_NODE = 106.9059\nARG_OF_PERICENTER = 268.2073\nMEAN_ANOMALY = 91.8026\nEPHEMERIS_TYPE = 0\nCLASSIFICATION_TYPE = U\nNORAD_CAT_ID = 25544\nELEMENT_SET_NO = 999\nREV_AT_EPOCH = 12345\nBSTAR = 0.000036618\nMEAN_MOTION_DOT = 0.000033220\nMEAN_MOTION_DDOT = 0\n</textarea><br>\n    <button onclick=\"testKVNOMM()\">Test KVN OMM</button>\n    \n    <h2>Test TLE (for comparison)</h2>\n    <textarea id=\"tle\" rows=\"3\" cols=\"80\">1 25544U 98067A   21294.59212991  .00004768  00000-0  94219-4 0  9991\n2 25544  51.6442 308.2048 0003165 223.2180 238.3999 15.48999236316687</textarea><br>\n    <button onclick=\"testTLE()\">Test TLE</button>\n\n    <div id=\"result\"></div>\n\n    <script>\n        // Include the functions we added to app.js\n        function validateOMM(ommData) {\n            try {\n                // If it's a string, try to parse it as JSON first\n                let ommObject;\n                if (typeof ommData === 'string') {\n                    // Check if it looks like KVN format (contains key=value pairs)\n                    if (ommData.includes('=')) {\n                        // Try to parse as KVN format\n                        ommObject = parseOMMKVN(ommData);\n                    } else {\n                        // Try to parse as JSON\n                        ommObject = JSON.parse(ommData);\n                    }\n                } else {\n                    ommObject = ommData;\n                }\n                \n                // Validate required OMM fields\n                const requiredFields = [\n                    'OBJECT_NAME',\n                    'NORAD_CAT_ID', \n                    'EPOCH',\n                    'MEAN_MOTION',\n                    'ECCENTRICITY',\n                    'INCLINATION',\n                    'RA_OF_ASC_NODE',\n                    'ARG_OF_PERICENTER',\n                    'MEAN_ANOMALY'\n                ];\n                \n                for (const field of requiredFields) {\n                    if (ommObject[field] === undefined) {\n                        return false;\n                    }\n                }\n                \n                // Validate data types\n                if (typeof ommObject.NORAD_CAT_ID !== 'number' && typeof ommObject.NORAD_CAT_ID !== 'string') {\n                    return false;\n                }\n                \n                if (typeof ommObject.EPOCH !== 'string') {\n                    return false;\n                }\n                \n                if (isNaN(parseFloat(ommObject.MEAN_MOTION)) || isNaN(parseFloat(ommObject.ECCENTRICITY)) ||\n                    isNaN(parseFloat(ommObject.INCLINATION)) || isNaN(parseFloat(ommObject.RA_OF_ASC_NODE)) ||\n                    isNaN(parseFloat(ommObject.ARG_OF_PERICENTER)) || isNaN(parseFloat(ommObject.MEAN_ANOMALY))) {\n                    return false;\n                }\n                \n                return true;\n            } catch (error) {\n                // If parsing fails, it's not valid OMM\n                console.error('Error validating OMM:', error);\n                return false;\n            }\n        }\n\n        function parseOMMKVN(kvnString) {\n            const lines = kvnString.split('\\n').map(line => line.trim()).filter(line => line.length > 0);\n            const ommObject = {};\n            \n            for (const line of lines) {\n                // Look for key = value pattern, allowing for optional whitespace\n                const match = line.match(/^([A-Z_][A-Z0-9_]*)\\s*=\\s*(.*?)\\s*$/);\n                if (match) {\n                    const key = match[1];\n                    let value = match[2].trim();\n                    \n                    // Try to convert to appropriate data type\n                    if (value === 'true') {\n                        value = true;\n                    } else if (value === 'false') {\n                        value = false;\n                    } else if (value === 'null') {\n                        value = null;\n                    } else if (value.match(/^-?\\d+\\.\\d+$/)) {\n                        // Float value\n                        value = parseFloat(value);\n                    } else if (value.match(/^\\d+$/)) {\n                        // Integer value\n                        value = parseInt(value, 10);\n                    } else if (value.match(/^-?\\d+$/)) {\n                        // Negative integer value\n                        value = parseInt(value, 10);\n                    } else {\n                        // Remove quotes if present\n                        if ((value.startsWith('\"') && value.endsWith('\"')) || (value.startsWith(\"'\") && value.endsWith(\"'\"))) {\n                            value = value.substring(1, value.length - 1);\n                        }\n                    }\n                    \n                    ommObject[key] = value;\n                }\n            }\n            \n            return ommObject;\n        }\n\n        function testJSONOMM() {\n            const ommData = document.getElementById('json-omm').value;\n            const isValid = validateOMM(ommData);\n            let result = `JSON OMM validation: ${isValid ? 'PASS' : 'FAIL'}<br>`;\n            \n            if (isValid) {\n                try {\n                    const ommObject = JSON.parse(ommData);\n                    result += `Satellite: ${ommObject.OBJECT_NAME}<br>`;\n                    result += `NORAD ID: ${ommObject.NORAD_CAT_ID}<br>`;\n                    \n                    // Test satellite.js json2satrec\n                    const satrec = satellite.json2satrec(ommObject);\n                    if (satrec.error) {\n                        result += `Satellite propagation error: ${satrec.error}`;\n                    } else {\n                        result += 'Satrec created successfully<br>';\n                    }\n                } catch (e) {\n                    result += `Error parsing JSON: ${e.message}`;\n                }\n            }\n            \n            document.getElementById('result').innerHTML = result;\n        }\n\n        function testKVNOMM() {\n            const kvnData = document.getElementById('kvn-omm').value;\n            const isValid = validateOMM(kvnData);\n            let result = `KVN OMM validation: ${isValid ? 'PASS' : 'FAIL'}<br>`;\n            \n            if (isValid) {\n                try {\n                    const ommObject = parseOMMKVN(kvnData);\n                    result += `Satellite: ${ommObject.OBJECT_NAME}<br>`;\n                    result += `NORAD ID: ${ommObject.NORAD_CAT_ID}<br>`;\n                    \n                    // Test satellite.js json2satrec\n                    const satrec = satellite.json2satrec(ommObject);\n                    if (satrec.error) {\n                        result += `Satellite propagation error: ${satrec.error}`;\n                    } else {\n                        result += 'Satrec created successfully<br>';\n                    }\n                } catch (e) {\n                    result += `Error parsing KVN: ${e.message}`;\n                }\n            }\n            \n            document.getElementById('result').innerHTML = result;\n        }\n\n        function testTLE() {\n            const tleData = document.getElementById('tle').value;\n            const lines = tleData.split('\\n').filter(line => line.trim().length > 0);\n            \n            if (lines.length >= 2) {\n                try {\n                    const satrec = satellite.twoline2satrec(lines[0], lines[1]);\n                    if (satrec.error) {\n                        result = `TLE propagation error: ${satrec.error}`;\n                    } else {\n                        result = 'TLE test: PASS<br>';\n                        result += `Satrec created successfully<br>`;\n                    }\n                } catch (e) {\n                    result = `Error with TLE: ${e.message}`;\n                }\n            } else {\n                result = 'Invalid TLE: must have at least 2 lines';\n            }\n            \n            document.getElementById('result').innerHTML = result;\n        }\n    </script>\n</body>\n</html>